# Somniverse - 꿈 기록 및 AI 기반 해몽/인사이트 도우미 웹 서비스

# I. 요구사항 정의

## 1) 타겟 사용자

- 자신의 꿈을 기록 및 관리하고 싶은 사람
- 꿈의 해몽이나 해석이 궁금한 사람(재미로)
- 타인과 꿈 이야기를 나누고, 공감받고 싶은 사람 (익명 기반)

## 2) 기능 정의 (MVP)

- **사용자 인증**
    1. 회원가입 (이메일, 비밀번호, 사용자명)
    2. 로그인 (토큰 발급)
    3. 로그아웃 (토큰 폐기)
    4. 토큰 재발급

- **꿈 일기 관리 (CRUD)**
    1. 꿈 일기 작성 (제목, 내용, 날짜, 공개 여부)
    2. 꿈 일기 단건 조회
    3. 꿈 일기 수정
    4. 꿈 일기 삭제
    5. 내 꿈 목록 조회
    6. 특정 사용자 공개 꿈 목록 조회
    7. 전체 공개 꿈 목록 조회

- **댓글 기능**
    1. 댓글 작성
    2. 꿈 일기별 댓글 목록 조회 (최상위)
    3. 대댓글 목록 조회
    4. 댓글 수정
    5. 댓글 삭제 (본인만)

- **AI 기능 (부가)**
    1. 태그 추천
    2. AI 해몽 요청

- **회원 관리 (사용자)**
    1. 내 정보 조회
    2. 사용자명 변경

- **관리자 기능**
    1. 사용자 목록 조회 / 단건 조회
    2. 사용자 권한 변경
    3. 전체 꿈 일기 목록 조회 (공개/비공개 포함)
    4. 꿈 일기 단건 조회
    5. 관리자에 의한 꿈 일기 삭제
    6. 관리자에 의한 댓글 삭제

## 3) 유스케이스

### 사용자

| ID    | 기능             | 인수 조건 (Acceptance Criteria)                                            |
|-------|----------------|------------------------------------------------------------------------|
| U-001 | 회원가입           | 이메일, 비밀번호, 사용자명 입력 → 성공 시 계정 생성<br>중복 이메일/사용자명 불가                      |
| U-002 | 로그인            | 이메일, 비밀번호 입력 → 성공 시 Access/Refresh 토큰 발급<br>실패 시 `401 Unauthorized`    |
| U-003 | 로그아웃           | Access/Refresh 토큰 폐기 → 성공 시 `204 No Content` 반환                        |
| U-004 | 토큰 재발급         | Refresh 토큰을 이용해 새로운 Access/Refresh 토큰 발급<br>실패 시 `401 Unauthorized`    |
| U-005 | 꿈 일기 작성        | 제목, 내용, 날짜, 공개 여부 입력 후 등록<br>성공 시 `201 Created` 반환                     |
| U-006 | 꿈 일기 단건 조회     | 특정 `dreamId`로 조회<br>권한 없는 경우 `403 Forbidden`, 존재하지 않으면 `404 Not Found` |
| U-007 | 꿈 일기 수정        | 본인이 작성한 꿈 일기만 수정 가능<br>성공 시 `200 OK`, 권한 없는 경우 `403 Forbidden`         |
| U-008 | 꿈 일기 삭제        | 본인이 작성한 꿈 일기만 삭제 가능<br>성공 시 `204 No Content` 반환                        |
| U-009 | 내 꿈 목록 조회      | 로그인 사용자의 모든 꿈 일기 목록 페이징 조회                                             |
| U-010 | 특정 사용자 꿈 목록 조회 | 특정 사용자(`memberId`)가 공개한 꿈 일기 목록 페이징 조회                                 |
| U-011 | 전체 공개 꿈 목록 조회  | 전체 공개된 꿈 일기 목록 페이징 조회                                                  |
| U-012 | 댓글 작성          | 꿈 일기에 댓글 작성 (본문 필수)<br>성공 시 `201 Created` 반환                           |
| U-013 | 댓글 목록 조회       | 꿈 일기 최상위 댓글 목록 페이징 조회                                                  |
| U-014 | 대댓글 목록 조회      | 특정 댓글(`commentId`)의 대댓글 목록 페이징 조회                                      |
| U-015 | 댓글 수정          | 본인이 작성한 댓글만 수정 가능<br>성공 시 `200 OK`, 실패 시 `403 Forbidden`               |
| U-016 | 댓글 삭제          | 본인이 작성한 댓글만 삭제 가능<br>성공 시 `204 No Content` 반환                          |
| U-017 | 내 정보 조회        | 현재 로그인된 사용자 정보 반환                                                      |
| U-018 | 사용자명 변경        | 새 사용자명 입력 → 성공 시 변경됨<br>중복 사용자명 불가 시 `409 Conflict`                    |
| U-019 | AI 태그 추천       | 꿈 내용 입력 시 AI가 추천 태그 반환                                                 |
| U-020 | AI 해몽 요청       | 꿈 내용 입력 시 AI가 해석 및 키워드 반환                                              |

### 관리자

| ID    | 기능            | 인수 조건 (Acceptance Criteria)                                      |
|-------|---------------|------------------------------------------------------------------|
| A-001 | 사용자 목록 조회     | 전체 사용자 목록 페이징 조회                                                 |
| A-002 | 사용자 단건 조회     | 특정 사용자(`memberId`) 조회<br>존재하지 않으면 `404 Not Found` 반환             |
| A-003 | 사용자 권한 변경     | 특정 사용자의 권한 변경 가능 (예: 일반 → 관리자)<br>성공 시 `200 OK`                  |
| A-004 | 전체 꿈 일기 목록 조회 | 공개/비공개/삭제 포함 전체 꿈 일기 페이징 조회                                      |
| A-005 | 꿈 일기 단건 조회    | 특정 `dreamId`의 꿈 일기 조회 (공개/비공개 포함)<br>존재하지 않으면 `404 Not Found` 반환 |
| A-006 | 관리자 꿈 일기 삭제   | 특정 꿈 일기 삭제 가능<br>성공 시 `204 No Content`                           |
| A-007 | 관리자 댓글 삭제     | 특정 댓글 삭제 가능<br>성공 시 `204 No Content`                             |

## 4) API 명세서

### 1. 사용자 인증

| 기능          | 메서드    | Endpoint            | 설명                                 | 요청 항목 예시                                                                  | 응답 코드 및 설명                                       |
|-------------|--------|---------------------|------------------------------------|---------------------------------------------------------------------------|--------------------------------------------------|
| 회원가입        | POST   | `/api/auth/members` | 사용자 계정 생성                          | - Body: `email`, `password`, `username`                                   | `201`: 성공<br>`400`: 유효성 오류<br>`409`: 중복 이메일/사용자명 |
| 로그인 (토큰 발급) | POST   | `/api/auth/tokens`  | 로그인 후 액세스/리프레시 토큰 발급               | - Body: `email`, `password`                                               | `200`: 토큰 및 사용자 정보 반환<br>`401`: 인증 실패            |
| 로그아웃        | DELETE | `/api/auth/tokens`  | 로그아웃: 리프레시 토큰 폐기 + 액세스 토큰 블랙리스트 등록 | - Header: `Authorization: Bearer accessToken`<br>- Cookie: `refreshToken` | `204`: 성공<br>`401`: 인증 실패 또는 토큰 없음               |
| 토큰 재발급      | PUT    | `/api/auth/tokens`  | 리프레시 토큰을 이용해 새로운 액세스/리프레시 토큰 재발급   | - Cookie: `refreshToken`                                                  | `200`: 새 토큰 발급<br>`401`: 유효하지 않은 토큰              |

### 2. 꿈 일기

| 기능            | 메서드    | Endpoint                        | 설명                    | 요청 항목 예시                                                                 | 응답 코드 및 설명                                                                   |
|---------------|--------|---------------------------------|-----------------------|--------------------------------------------------------------------------|------------------------------------------------------------------------------|
| 꿈 일기 작성       | POST   | `/api/dreams`                   | 꿈 일기를 작성              | - Body: `title`, `content`, `dreamDate`, `isPublic`                      | `201`: 등록 성공<br>`400`: 유효성 오류<br>`401`: 인증 실패                                |
| 꿈 일기 단건 조회    | GET    | `/api/dreams/{dreamId}`         | 특정 꿈 일기를 조회           | - Path: `dreamId`                                                        | `200`: 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음                  |
| 꿈 일기 수정       | PUT    | `/api/dreams/{dreamId}`         | 특정 꿈 일기를 수정           | - Path: `dreamId`<br>- Body: `title`, `content`, `dreamDate`, `isPublic` | `200`: 성공<br>`400`: 유효성 오류<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |
| 꿈 일기 삭제       | DELETE | `/api/dreams/{dreamId}`         | 특정 꿈 일기를 삭제           | - Path: `dreamId`                                                        | `204`: 삭제 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음               |
| 내 꿈 목록 조회     | GET    | `/api/dreams/me`                | 로그인 사용자의 꿈 일기 목록 조회   | - Query: `page`, `size`, `sort`                                          | `200`: 성공<br>`401`: 인증 실패                                                    |
| 특정 유저 꿈 목록 조회 | GET    | `/api/dreams/member/{memberId}` | 특정 유저가 공개한 꿈 일기 목록 조회 | - Path: `memberId`<br>- Query: `page`, `size`, `sort`                    | `200`: 성공                                                                    |
| 공개 꿈 목록 조회    | GET    | `/api/dreams`                   | 전체 공개 꿈 일기 목록 조회      | - Query: `page`, `size`, `sort`                                          | `200`: 성공                                                                    |

### 3. 꿈 일기 - 관리자 기능

| 기능          | 메서드    | Endpoint                      | 설명                                | 요청 항목 예시                                       | 응답 코드 및 설명                                                     |
|-------------|--------|-------------------------------|-----------------------------------|------------------------------------------------|----------------------------------------------------------------|
| 관리자 꿈 목록 조회 | GET    | `/api/admin/dreams`           | 관리자: 전체 꿈 일기 목록 조회 (공개/비공개/삭제 포함) | - Query: `page`, `size`, `includeDeleted`      | `200`: 성공<br>`401`: 인증 실패<br>`403`: 인가 실패                      |
| 관리자 꿈 단건 조회 | GET    | `/api/admin/dreams/{dreamId}` | 관리자: 특정 꿈 일기 조회 (공개/비공개/삭제 포함)    | - Path: `dreamId`<br>- Query: `includeDeleted` | `200`: 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`             |
| 관리자 꿈 일기 삭제 | DELETE | `/api/admin/dreams/{dreamId}` | 관리자: 특정 꿈 일기를 삭제                  | - Path: `dreamId`                              | `204`: 삭제 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |

### 4. 댓글

| 기능             | 메서드    | Endpoint                             | 설명                       | 요청 항목 예시                                               | 응답 코드 및 설명                                                                      |
|----------------|--------|--------------------------------------|--------------------------|--------------------------------------------------------|---------------------------------------------------------------------------------|
| 댓글 작성          | POST   | `/api/dreams/{dreamId}/comments`     | 꿈 일기에 댓글 작성              | - Path: `dreamId`<br>- Body: `content`                 | `201`: 생성 성공<br>`400`: 유효성 오류<br>`401`: 인증 실패<br>`404`: 존재하지 않음                 |
| 댓글 목록 조회 (최상위) | GET    | `/api/dreams/{dreamId}/comments`     | 꿈 일기의 최상위 댓글 목록 조회 (페이징) | - Path: `dreamId`<br>- Query: `page`, `size`, `sort`   | `200`: 조회 성공<br>`401`: 인증 실패<br>`404`: 존재하지 않음                                  |
| 대댓글 목록 조회      | GET    | `/api/comments/{commentId}/children` | 특정 댓글의 대댓글 목록 조회 (페이징)   | - Path: `commentId`<br>- Query: `page`, `size`, `sort` | `200`: 조회 성공<br>`401`: 인증 실패<br>`404`: 존재하지 않음                                  |
| 댓글 수정          | PUT    | `/api/comments/{commentId}`          | 댓글 내용 수정                 | - Path: `commentId`<br>- Body: `content`               | `200`: 수정 성공<br>`400`: 유효성 오류<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |
| 댓글 삭제 (사용자)    | DELETE | `/api/comments/{commentId}`          | 댓글 삭제 (본인만 가능)           | - Path: `commentId`                                    | `204`: 삭제 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음                  |

### 5. 댓글 - 관리자

| 기능        | 메서드    | Endpoint                          | 설명              | 요청 항목 예시            | 응답 코드 및 설명                                                     |
|-----------|--------|-----------------------------------|-----------------|---------------------|----------------------------------------------------------------|
| 관리자 댓글 삭제 | DELETE | `/api/admin/comments/{commentId}` | 관리자 : 특정 댓글을 삭제 | - Path: `commentId` | `204`: 삭제 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |

### 6. 회원 관리 - 일반 사용자

| 기능      | 메서드   | Endpoint          | 설명                | 요청 항목 예시                                 | 응답 코드 및 설명                                                      |
|---------|-------|-------------------|-------------------|------------------------------------------|-----------------------------------------------------------------|
| 내 정보 조회 | GET   | `/api/members/me` | 현재 로그인된 사용자 정보 조회 | Query: `page`, `size`, `sort`, `keyword` | `200`: 조회 성공<br>`401`: 인증 실패                                    |
| 사용자명 변경 | PATCH | `/api/members/me` | 현재 로그인된 사용자명 변경   | - Body: `username`                       | `200`: 변경 성공<br>`401`: 인증 실패<br>`400`: 유효성 오류<br>`409`: 중복 사용자명 |

### 7. 회원 관리 - 관리자

| 기능        | 메서드   | Endpoint                             | 설명                          | 요청 항목 예시                                   | 응답 코드 및 설명                                                     |
|-----------|-------|--------------------------------------|-----------------------------|--------------------------------------------|----------------------------------------------------------------|
| 사용자 목록 조회 | GET   | `/api/admin/members`                 | 전체 사용자 목록 조회 (페이징)          | - Query: `page`, `size`, `sort`, `keyword` | `200`: 조회 성공<br>`401`: 인증 실패<br>`403`: 인가 실패                   |
| 사용자 단건 조회 | GET   | `/api/admin/members/{memberId}`      | 전체 사용자 목록 조회 (페이징)          | - Path: `memberId`                         | `200`: 조회 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |
| 사용자 권한 변경 | PATCH | `/api/admin/members/{memberId}/role` | 사용자 권한 변경(예. 책임자, 관리자, 사용자) | - Path: `memberId` <br> - Body: `role`     | `200`: 조회 성공<br>`401`: 인증 실패<br>`403`: 인가 실패<br>`404`: 존재하지 않음 |

### (미정) AI 부가 기능

| 기능       | 메서드  | Endpoint                  | 설명                | 요청 항목 예시                           | 응답 코드 및 설명                                             |
|----------|------|---------------------------|-------------------|------------------------------------|--------------------------------------------------------|
| 태그 제안    | POST | `/api/ai/suggest-tags`    | 꿈 내용 기반 태그 추천     | `dreamContent`                     | `200 OK`: `suggestedTags` 반환<br>`400/401`              |
| AI 해몽 요청 | POST | `/api/ai/interpret-dream` | 꿈 내용에 대한 AI 해석 요청 | `dreamContent`, `emotionTags (선택)` | `200 OK`: `interpretation`, `keywords` 반환<br>`400/401` |

## 5) ERD

![Image](https://github.com/user-attachments/assets/c3f1d684-72e1-4dea-9672-b972841807a1)